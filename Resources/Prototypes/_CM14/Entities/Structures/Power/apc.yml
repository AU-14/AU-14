- type: entity
  noSpawn: true
  parent: BaseAPC
  id: CMApcBase
  name: area power controller
  description: A control terminal for the area electrical systems.
  components:
  - type: AccessReader
    access: [["CMAccessEngineering"]]
  - type: Sprite
    drawdepth: WallMountedItems
    sprite: _CM14/Structures/Power/apc.rsi
    layers:
    - state: base
    - state: panel
      map: ["enum.WiresVisualLayers.MaintenancePanel"]
      visible: false
    - state: display-charging
      shader: unshaded
      map: ["enum.ApcVisualLayers.ChargeState"]
    - state: apcox-0
      shader: unshaded
      map: ["enum.ApcVisualLayers.InterfaceLock"]
    - state: apcox-1
      shader: unshaded
      map: ["enum.ApcVisualLayers.PanelLock"]
    - state: apco0-2
      shader: unshaded
      map: ["enum.ApcVisualLayers.Equipment"]
    - state: apco1-2
      shader: unshaded
      map: ["enum.ApcVisualLayers.Lighting"]
    - state: apco2-2
      shader: unshaded
      map: ["enum.ApcVisualLayers.Environment"]
  - type: Appearance
  - type: ApcVisuals
  - type: PowerMonitoringDevice
    group: APC
    sourceNode: input
    loadNode: output
    collectionName: apc
    sprite: _CM14/Structures/Power/apc.rsi
    state: base
  - type: Construction
    graph: CMApc
    node: apc
  - type: Wires
    boardName: wires-board-name-apc
    layoutId: APC
  - type: WiresVisuals
  - type: Destructible
    thresholds:
    - trigger:
        !type:DamageTrigger
        damage: 200
      behaviors:
      - !type:DoActsBehavior
        acts: [ "Destruction" ]
    - trigger:
        !type:DamageTrigger
        damage: 50
      behaviors:
      - !type:SpawnEntitiesBehavior
        spawn:
          CMSheetSteel1:
            min: 1
            max: 1
      - !type:DoActsBehavior
        acts: [ "Destruction" ]

# APC under construction
- type: entity
  noSpawn: true
  parent: APCFrame
  id: CMApcFrame
  name: APC frame
  description: A control terminal for the area's electrical systems, lacking the electronics.
  components:
  - type: Sprite
    sprite: _CM14/Structures/Power/apc.rsi
    state: panel
  - type: Construction
    graph: CMApc
    node: apcFrame
  - type: Destructible
    thresholds:
    - trigger:
        !type:DamageTrigger
        damage: 200
      behaviors:
      - !type:DoActsBehavior
        acts: [ "Destruction" ]
    - trigger:
        !type:DamageTrigger
        damage: 50
      behaviors:
      - !type:SpawnEntitiesBehavior
        spawn:
          CMSheetSteel1:
            min: 1
            max: 1
      - !type:DoActsBehavior
        acts: [ "Destruction" ]

# Constructed APC
- type: entity
  parent: CMApcBase
  id: CMApcConstructed
  suffix: Open
  components:
  - type: WiresPanel
    open: true

# APCs in use
- type: entity
  parent: CMApcBase
  id: CMApcLowCapacity
  suffix: Small powercell, 50kW
  components: # todo cm14 / TODO cm14 make apc use powercells
  - type: Battery
    maxCharge: 50000
    startingCharge: 50000

- type: entity
  parent: CMApcBase
  id: CMApcMediumCapacity
  suffix: Medium powercell, 100kW
  components:
  - type: Battery
    maxCharge: 100000
    startingCharge: 100000

- type: entity
  parent: CMApcBase
  id: CMApcHighCapacity
  suffix: High powercell, 150kW
  components:
  - type: Battery
    maxCharge: 150000
    startingCharge: 150000

